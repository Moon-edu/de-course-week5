import psycopg

"""
이 파일은 수강생의 과제 구현 결과를 체크하기 위한 테스트 로직입니다.
이 파일을 변경하면 제대로 채점이 되지 않으므로 절대 변경하지 마세요
"""

def query(q):
    with psycopg.connect(f"host=localhost dbname=stock "
                         + f"user=stock-importer password=stock") as conn:
        with conn.cursor() as cur:
            cur.execute(q)
            return cur.fetchall()


def test_validate_group_count():
    r = query("""select code, count(*) c, max(price), min(price), sum(price), max(price_date), min(price_date) from stock group by code""")
    r.sort(key=lambda k: k[0])
    assert r == [
          ("A10000", 31, 61740, 47510, 1636360, '2021-01-31', '2021-01-01')
        , ("A10030", 31, 191810, 162390, 5501000, '2021-01-31', '2021-01-01')
        , ("A10079", 31, 429580, 340000, 11873140, '2021-01-31', '2021-01-01')
        , ("A10239", 31, 112540, 86980, 3070030, '2021-01-31', '2021-01-01')
        , ("A10771", 31, 100000, 76170, 2708750, '2021-01-31', '2021-01-01')
        , ("A20301", 31, 226250, 182770, 6171830, '2021-01-31', '2021-01-01')
        , ("A23985", 31, 297140, 253640, 8527860, '2021-01-31', '2021-01-01')
        , ("A32526", 31, 216300, 186860, 6232250, '2021-01-31', '2021-01-01')
        , ("A35580", 31, 167090, 123970, 4524410, '2021-01-31', '2021-01-01')
        , ("A52201", 31, 879520, 695040, 24281940, '2021-01-31', '2021-01-01')
        , ("A77553", 31, 7630, 6020, 211610, '2021-01-31', '2021-01-01')
        , ("A90230", 31, 40960, 30000, 1068950, '2021-01-31', '2021-01-01')
        , ("A94220", 31, 363110, 241060, 9414670, '2021-01-31', '2021-01-01')
        , ("A94873", 31, 13080, 9860, 352880, '2021-01-31', '2021-01-01')
        , ("A99031", 31, 9000, 6710, 236270, '2021-01-31', '2021-01-01')
        , ("A99877", 31, 531060, 440640, 15033470, '2021-01-31', '2021-01-01')
        , ("A99912", 31, 10960, 8790, 299630, '2021-01-31', '2021-01-01')
    ]
